<pre>
<script>

    let xregexp = {
        InputElement: "<Whitespace>|<LineTerminator>|<Comments>|<Token>",
        Whitespace: / /,
        LineTerminator: /\n/,
        Comments: "<MultiLineComments>|<SingleLineComments>",
        MultiLineComments: /\/\*([^*]|\*(?!\/))*\*\//,
        SingleLineComments: /\/\/[^\n]*/,
        Token: "<Literal>|<Keywords>|<Identifier>|<Punctuator>",
        Literal: "<NumericLiteral>|<BooleanLiteral>|<StringLiteral>|<NullLiteral>",
        NumericLiteral: /([1-9][0-9]*|0)(\.[0-9]*)?|\.[0-9]+/,
        BooleanLiteral: /true|false/,
        StringLiteral: /("([^"\n]|(?<=\\)")*")|'([^'\n]|(?<=\\)')*'/,
        NullLiteral: /null/,
        Identifier: /[a-zA-Z_$][a-zA-Z_$0-9]*/,
        Keywords: /if|else|for|function|let|var|const|new|switch|case|break|continue/,
        Punctuator: /==>|===|!==|==|!=|=|\(|\)|\[|\]|\{|\}|<|>|;|\:|,|\?|\.|\+\+|--|\+=|-=|\*=|\/=|\+|-|\*|\/|&&|\|\||!/,
    }

    function compileXRegExp(xregexp, name) {
        console.log(xregexp + " , " + name);//.
        if (xregexp[name] instanceof RegExp) {
            return xregexp[name].source;
        }
        let regexp = xregexp[name].replace(/\<([^>]+)\>/g, function($0, $1) {
            console.log('0: ' + $0 + " , 1: " + $1);
            return compileXRegExp(xregexp, $1);
        });
        console.log('returning: ' + regexp);//.
        return regexp;
    }

    let regexp = new RegExp(compileXRegExp(xregexp, 'InputElement'), 'g'); 
    console.log(regexp);

    function scan(str) {
        let matched;
        while ((matched = regexp.exec(str)) != null) {
            console.log(JSON.stringify(matched[0]));
            document.write(matched[0]);
        }
    }

    scan(`
function emit(token) {
    // 当前栈顶元素
    let top = stack[stack.length - 1];

    switch (token.type) {
        case 'startTag':
            
            let element = {
                type: 'element',
                tagName: token.tagName,
                children: [],
                attributes: []
            };

            for (let prop in token) {
                // 这里原文为 ||, 但 || 等同于恒为真
                if (prop != 'type' && prop != 'tagName') {
                    element.attributes.push({
                        name: prop,
                        value: token[prop]
                    });
                }
            }

            computeCss(element);

            top.children.push(element);
            if (!token.isSelfClosing) {
                stack.push(element);
            }

            currentTextNode = null;

            break;
        case 'endTag':

            if (top.tagName != token.tagName) {
                throw new Error('Tag start end doesn\\'t match!');
            } else {
                if (top.tagName === 'style') {
                    // 取出其中文本节点的 content 进行处理
                    addCssRules(top.children[0].content);
                }
                layout(top);
                // 弹出对应的开始标签
                stack.pop();
            }
            currentTextNode = null;

            break;
        case 'text':

            if (currentTextNode == null) {
                currentTextNode = {
                    type: 'text',
                    content: ''
                };
                top.children.push(currentTextNode);
            }
            currentTextNode.content += token.content;

            break;
    }
}
    `);
</script>
</pre>